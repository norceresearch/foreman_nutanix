<h4>Cluster Information</h4>
<table class="table table-striped table-condensed">
  <% if @compute_resource.cluster_details %>
    <% @compute_resource.cluster_details.to_h.each do |key, value| %>
      <tr>
        <td><%= key %></td>
        <td><%= value %></td>
      </tr>
    <% end %>
  <% else %>
    <tr>
      <td colspan="2">No cluster details available</td>
    </tr>
  <% end %>
</table>

<hr style="margin: 30px 0;">

<h4>Debug Information</h4>
<table class="table table-striped table-condensed">
  <tr>
    <td>Provider</td>
    <td><%= @compute_resource.provider_friendly_name %></td>
  </tr>
  <tr>
    <td>Capabilities</td>
    <td><%= @compute_resource.capabilities.join(", ") %></td>
  </tr>
  <tr>
    <td>User Data Support</td>
    <td><%= @compute_resource.user_data_supported? ? 'Yes' : 'No' %></td>
  </tr>
  <tr>
    <td>Shim Server URL</td>
    <td><code><%= @compute_resource.shim_server_url %></code></td>
  </tr>
  <tr>
    <td>Cluster ID</td>
    <td><code><%= @compute_resource.cluster || "Not set" %></code></td>
  </tr>
  <tr>
    <td>Cluster Name</td>
    <td><%= @compute_resource.cluster_details&.name || "N/A" %></td>
  </tr>
  <tr>
    <td>Resource Counts</td>
    <td>
      <strong>Networks:</strong> <%= @compute_resource.available_networks.count %> |
      <strong>Storage Containers:</strong> <%= @compute_resource.available_storage_containers.count %> |
      <strong>Images:</strong> <%= @compute_resource.available_images.count %> |
      <strong>Flavors:</strong> <%= @compute_resource.available_flavors.count %>
    </td>
  </tr>
</table>

<hr style="margin: 30px 0;">

<h4>Available Resources</h4>
<div class="row">
  <div class="col-md-6">
    <h5>Networks</h5>
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Subnet</th>
          <th>Gateway</th>
        </tr>
      </thead>
      <tbody>
        <% @compute_resource.available_networks.each do |network| %>
          <tr>
            <td><%= network.name %></td>
            <td><%= network.subnet_type %></td>
            <td><%= network.ipv4_subnet %></td>
            <td><%= network.ipv4_gateway %></td>
          </tr>
        <% end %>
        <% if @compute_resource.available_networks.empty? %>
          <tr>
            <td colspan="4">No networks available</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="col-md-6">
    <h5>Storage Containers</h5>
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>Name</th>
          <th>Capacity (GB)</th>
          <th>Replication</th>
          <th>Compression</th>
        </tr>
      </thead>
      <tbody>
        <% @compute_resource.available_storage_containers.each do |container| %>
          <tr>
            <td><%= container.name %></td>
            <td><%= (container.max_capacity_bytes.to_f / 1024**3).round(2) %></td>
            <td><%= container.replication_factor %>x</td>
            <td><%= container.is_compression_enabled ? 'Yes' : 'No' %></td>
          </tr>
        <% end %>
        <% if @compute_resource.available_storage_containers.empty? %>
          <tr>
            <td colspan="4">No storage containers available</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<hr style="margin: 30px 0;">

<h4>Cluster Resource Availability</h4>
<% stats = @compute_resource.cluster_resource_stats %>
<% if stats %>
  <table class="table table-striped table-condensed">
    <thead>
      <tr>
        <th>Resource</th>
        <th>Capacity</th>
        <th>Used</th>
        <th>Available</th>
        <th>Usage</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>CPU</strong></td>
        <td><%= (stats.cpu_capacity_hz.to_f / 1_000_000_000).round(2) %> GHz</td>
        <td><%= (stats.cpu_usage_hz.to_f / 1_000_000_000).round(2) %> GHz</td>
        <td><%= ((stats.cpu_capacity_hz - stats.cpu_usage_hz).to_f / 1_000_000_000).round(2) %> GHz</td>
        <td>
          <div class="progress" style="margin-bottom: 0;">
            <div class="progress-bar <%= stats.cpu_usage_percent > 80 ? 'progress-bar-danger' : stats.cpu_usage_percent > 60 ? 'progress-bar-warning' : 'progress-bar-success' %>"
                 role="progressbar"
                 aria-valuenow="<%= stats.cpu_usage_percent %>"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 style="width: <%= stats.cpu_usage_percent %>%">
              <%= stats.cpu_usage_percent %>%
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Memory</strong></td>
        <td><%= (stats.memory_capacity_bytes.to_f / 1024**3).round(2) %> GB</td>
        <td><%= (stats.memory_usage_bytes.to_f / 1024**3).round(2) %> GB</td>
        <td><%= ((stats.memory_capacity_bytes - stats.memory_usage_bytes).to_f / 1024**3).round(2) %> GB</td>
        <td>
          <div class="progress" style="margin-bottom: 0;">
            <div class="progress-bar <%= stats.memory_usage_percent > 80 ? 'progress-bar-danger' : stats.memory_usage_percent > 60 ? 'progress-bar-warning' : 'progress-bar-success' %>"
                 role="progressbar"
                 aria-valuenow="<%= stats.memory_usage_percent %>"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 style="width: <%= stats.memory_usage_percent %>%">
              <%= stats.memory_usage_percent %>%
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Storage</strong></td>
        <td><%= (stats.storage_capacity_bytes.to_f / 1024**4).round(2) %> TB</td>
        <td><%= (stats.storage_usage_bytes.to_f / 1024**4).round(2) %> TB</td>
        <td><%= ((stats.storage_capacity_bytes - stats.storage_usage_bytes).to_f / 1024**4).round(2) %> TB</td>
        <td>
          <div class="progress" style="margin-bottom: 0;">
            <div class="progress-bar <%= stats.storage_usage_percent > 80 ? 'progress-bar-danger' : stats.storage_usage_percent > 60 ? 'progress-bar-warning' : 'progress-bar-success' %>"
                 role="progressbar"
                 aria-valuenow="<%= stats.storage_usage_percent %>"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 style="width: <%= stats.storage_usage_percent %>%">
              <%= stats.storage_usage_percent %>%
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
<% else %>
  <p class="text-muted">Unable to fetch cluster resource statistics</p>
<% end %>

<hr style="margin: 30px 0;">

<h4>Images</h4>
<% if @compute_resource.available_images.empty? %>
  <p class="text-muted">No images available</p>
<% else %>
  <ul>
    <% @compute_resource.available_images.each do |image| %>
      <li><%= image.name %>
        (<%= image.id %>)</li>
    <% end %>
  </ul>
<% end %>
